<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ruleta Casino PRO MAX</title>

<link rel="apple-touch-icon" sizes="1024x1024" href="icono.png">

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    text-align:center;
    background: radial-gradient(circle at top,#1b2a49,#0f172a);
    color:white;
}

h1{margin-top:20px;}

input{
    padding:10px;
    margin:5px;
    border-radius:8px;
    border:none;
    width:200px;
}

button{
    padding:10px 20px;
    margin:10px;
    border:none;
    border-radius:8px;
    font-weight:bold;
    cursor:pointer;
}

#agregar{background:#16a34a;color:white;}
#iniciar{background:#facc15;}
#limpiar{background:#dc2626;color:white;}

#resultado{
    font-size:30px;
    margin-top:20px;
    font-weight:bold;
    min-height:40px;
}

/* CONTENEDOR */
.ruleta-wrapper{
    position: relative;
    width: 360px;
    height: 360px;
    margin: 20px auto;
}

/* LED RING */
.led-ring{
    position:absolute;
    width:360px;
    height:360px;
    border-radius:50%;
    animation: girarLED 8s linear infinite;
}

.led{
    position:absolute;
    width:10px;
    height:10px;
    border-radius:50%;
    background:#ffd700;
    box-shadow:0 0 8px #fff, 0 0 15px #ffd700;
}

@keyframes girarLED{
    from{transform:rotate(0deg);}
    to{transform:rotate(360deg);}
}

canvas{
    position:absolute;
    top:5px;
    left:5px;
    background:white;
    border-radius:50%;
    z-index:1;
}

.puntero{
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 14px solid transparent;
    border-right: 14px solid transparent;
    border-bottom: 22px solid #ef4444;
    z-index: 3;
}

/* PANTALLA GANADOR */
#pantallaGanador{
    position:fixed;
    inset:0;
    background:#000c;
    display:none;
    align-items:center;
    justify-content:center;
    z-index:9999;
}

#ganadorTexto{
    font-size:clamp(40px,8vw,120px);
    font-weight:bold;
    color:#ffd700;
    text-shadow:0 0 20px #fff, 0 0 40px #ffd700;
    animation:pulse 1s infinite alternate;
}

@keyframes pulse{
    from{transform:scale(1);}
    to{transform:scale(1.1);}
}
</style>
</head>
<body>

<h1>ðŸŽ° Ruleta Casino PRO MAX</h1>

<input id="nombre" placeholder="Nombre">
<input id="numero" placeholder="NÃºmero" type="number">
<button id="agregar">Agregar</button>

<div>
<button id="iniciar">Iniciar Ruleta</button>
<button id="limpiar">Limpiar Lista</button>
</div>

<div class="ruleta-wrapper">

<div class="led-ring" id="ledRing"></div>

<div class="puntero"></div>

<canvas id="ruleta" width="350" height="350"></canvas>

</div>

<div id="resultado"></div>

<!-- PANTALLA GANADOR -->
<div id="pantallaGanador" onclick="this.style.display='none'">
<div id="ganadorTexto"></div>
</div>

<script>
let lista = JSON.parse(localStorage.getItem("lista_ruleta")) || [];
const canvas = document.getElementById("ruleta");
const ctx = canvas.getContext("2d");

let girando=false;
let anguloActual=0;
let indiceSeleccionado=-1;

const CX=175,CY=175,R=170;
const PUNTERO_ANG=-Math.PI/2;

/* ====== CREAR LEDS ====== */
const ring=document.getElementById("ledRing");
for(let i=0;i<40;i++){
    const led=document.createElement("div");
    led.className="led";
    const ang=(i/40)*2*Math.PI;
    const x=180+170*Math.cos(ang)-5;
    const y=180+170*Math.sin(ang)-5;
    led.style.left=x+"px";
    led.style.top=y+"px";
    ring.appendChild(led);
}

/* ====== GUARDAR ====== */
function guardar(){
 localStorage.setItem("lista_ruleta",JSON.stringify(lista));
}

/* ====== DIBUJAR ====== */
function dibujar(){
 ctx.clearRect(0,0,350,350);
 if(lista.length===0) return;

 const ang=2*Math.PI/lista.length;

 for(let i=0;i<lista.length;i++){

  ctx.beginPath();
  ctx.moveTo(CX,CY);
  ctx.arc(CX,CY,R,i*ang,(i+1)*ang);
  ctx.fillStyle=`hsl(${i*360/lista.length},70%,50%)`;
  ctx.fill();

  ctx.save();
  ctx.translate(CX,CY);
  ctx.rotate(i*ang+ang/2);
  ctx.fillStyle="white";
  ctx.textAlign="center";
  ctx.font="16px Arial";
  ctx.fillText(lista[i].nombre,R-60,0);
  ctx.restore();

  if(i===indiceSeleccionado){
    ctx.lineWidth=6;
    ctx.strokeStyle="#fde047";
    ctx.beginPath();
    ctx.arc(CX,CY,R-10,i*ang,(i+1)*ang);
    ctx.stroke();
  }
 }

 ctx.lineWidth=4;
 ctx.strokeStyle="#0f172a";
 ctx.beginPath();
 ctx.arc(CX,CY,R,0,2*Math.PI);
 ctx.stroke();
}

function redibujar(){
 ctx.save();
 ctx.translate(CX,CY);
 ctx.rotate(anguloActual);
 ctx.translate(-CX,-CY);
 dibujar();
 ctx.restore();
}

redibujar();

/* ====== AGREGAR ====== */
document.getElementById("agregar").onclick=function(){
 const n=document.getElementById("nombre").value.trim();
 const num=document.getElementById("numero").value.trim();
 if(!n||!num) return alert("Completa los datos");

 if(lista.some(x=>x.numero==num))
  return alert("NÃºmero repetido");

 lista.push({nombre:n,numero:num});
 guardar();
 redibujar();

 nombre.value="";
 numero.value="";
};

/* ====== LIMPIAR ====== */
document.getElementById("limpiar").onclick=function(){
 if(!confirm("Â¿Seguro que deseas borrar toda la lista?")) return;

 lista=[];
 guardar();
 indiceSeleccionado=-1;
 anguloActual=0;

 redibujar();
 resultado.innerText="";
};

/* ====== MOSTRAR GANADOR ====== */
function mostrarGanadorGigante(nombre){

 document.getElementById("ganadorTexto").innerText=
 "ðŸ† "+nombre+" ðŸ†";

 document.getElementById("pantallaGanador").style.display="flex";
}

/* ====== GIRAR ====== */
function girarYSeleccionar(index,callback){

 if(girando) return;
 girando=true;

 const n=lista.length;
 const ang=2*Math.PI/n;
 const vueltas=6;
 const dur=3000;

 const centro=index*ang+ang/2;
 const delta=PUNTERO_ANG-centro;

 ring.style.animationDuration="1s";

 const inicio=performance.now();

 function anim(t){
  let p=(t-inicio)/dur;
  if(p>1)p=1;

  anguloActual=delta*p+vueltas*2*Math.PI*p;
  redibujar();

  if(p<1) requestAnimationFrame(anim);
  else{
    indiceSeleccionado=index;
    redibujar();
    girando=false;

    ring.style.animationDuration="8s";

    callback(index);
  }
 }

 requestAnimationFrame(anim);
}

/* ====== INICIAR ====== */
document.getElementById("iniciar").onclick=async function(){

 if(lista.length<3)
  return alert("Necesitas mÃ­nimo 3 participantes");

 let copia=[...lista];

 for(let i=0;i<3;i++){

  const index=Math.floor(Math.random()*copia.length);
  resultado.innerText="ðŸŽ¯ "+copia[index].nombre;

  await new Promise(r=>setTimeout(r,3000));

  await new Promise(res=>{
   girarYSeleccionar(index,sel=>{

    const e=copia[sel];

    if(i<2){
     resultado.innerText=e.nombre+" - FUERA âŒ";
     copia.splice(sel,1);
     indiceSeleccionado=-1;
    }
    else{
     resultado.innerText="ðŸ† "+e.nombre+" GANADOR ðŸŽ‰";
     mostrarGanadorGigante(e.nombre);
    }

    res();
   });
  });

  if(i<2){
   lista=copia;
   guardar();
   redibujar();
   await new Promise(r=>setTimeout(r,4000));
  }
 }
};
</script>

</body>
</html>
