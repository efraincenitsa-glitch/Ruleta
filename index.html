<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ruleta Casino PRO</title>

<link rel="apple-touch-icon" sizes="1024x1024" href="icono.png">

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    text-align:center;
    background: radial-gradient(circle at top,#1b2a49,#0f172a);
    color:white;
}

h1{margin-top:20px;}

input{
    padding:10px;
    margin:5px;
    border-radius:8px;
    border:none;
    width:200px;
}

button{
    padding:10px 20px;
    margin:10px;
    border:none;
    border-radius:8px;
    font-weight:bold;
    cursor:pointer;
}

#agregar{background:#16a34a;color:white;}
#iniciar{background:#facc15;}
#limpiar{background:#dc2626;color:white;}

#resultado{
    font-size:32px;
    margin-top:20px;
    font-weight:bold;
    min-height:40px;
}

.ruleta-wrapper{
    position: relative;
    width: 360px;
    height: 360px;
    margin: 20px auto 0;
}

canvas{
    background:white;
    border-radius:50%;
    box-shadow:0 0 20px #000;
}

.puntero{
    position:absolute;
    top:-6px;
    left:50%;
    transform:translateX(-50%);
    width:0;height:0;
    border-left:14px solid transparent;
    border-right:14px solid transparent;
    border-bottom:22px solid #ef4444;
    z-index:2;
}

/* LED giratorio */
.ruleta-wrapper::before{
    content:"";
    position:absolute;
    inset:-12px;
    border-radius:50%;
    background:conic-gradient(
        red, yellow, lime, cyan, blue, magenta, red
    );
    animation:led 2s linear infinite;
    z-index:-1;
}

@keyframes led{
    from{transform:rotate(0deg);}
    to{transform:rotate(360deg);}
}

/* Pantalla ganador gigante */
#pantallaGanador{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.9);
    display:none;
    align-items:center;
    justify-content:center;
    font-size:64px;
    font-weight:bold;
    color:#fde047;
    text-align:center;
    z-index:999;
}
</style>
</head>
<body>

<h1>üé∞ Ruleta Casino PRO</h1>

<input id="nombre" placeholder="Nombre">
<input id="numero" placeholder="N√∫mero" type="number">
<button id="agregar">Agregar</button>

<div>
<button id="iniciar">Iniciar Ruleta</button>
<button id="limpiar">Limpiar Lista</button>
</div>

<div class="ruleta-wrapper">
  <div class="puntero"></div>
  <canvas id="ruleta" width="360" height="360"></canvas>
</div>

<div id="resultado"></div>

<div id="pantallaGanador"></div>

<script>

/* ===== REFERENCIAS DOM (IMPORTANTE) ===== */
const nombreInput = document.getElementById("nombre");
const numeroInput = document.getElementById("numero");
const resultado = document.getElementById("resultado");
const pantallaGanador = document.getElementById("pantallaGanador");
const btnAgregar = document.getElementById("agregar");
const btnIniciar = document.getElementById("iniciar");
const btnLimpiar = document.getElementById("limpiar");

let lista = JSON.parse(localStorage.getItem("lista_ruleta")) || [];
const canvas = document.getElementById("ruleta");
const ctx = canvas.getContext("2d");

let anguloActual = 0;

const CX=180, CY=180, R=170;
const PUNTERO_ANG=-Math.PI/2;

/* ===== VOZ CASINO ===== */
function hablar(texto, velocidad=0.9, tono=1){
    const msg = new SpeechSynthesisUtterance(texto);
    msg.lang="es-MX";
    msg.rate=velocidad;
    msg.pitch=tono;
    speechSynthesis.cancel();
    speechSynthesis.speak(msg);
}

function guardar(){
    localStorage.setItem("lista_ruleta",JSON.stringify(lista));
}

/* ===== DIBUJAR ===== */
function dibujar(){
    ctx.clearRect(0,0,360,360);
    if(lista.length===0) return;

    const ang=2*Math.PI/lista.length;

    for(let i=0;i<lista.length;i++){
        ctx.beginPath();
        ctx.moveTo(CX,CY);
        ctx.arc(CX,CY,R,i*ang,(i+1)*ang);
        ctx.fillStyle=`hsl(${i*360/lista.length},70%,50%)`;
        ctx.fill();

        ctx.save();
        ctx.translate(CX,CY);
        ctx.rotate(i*ang+ang/2);
        ctx.fillStyle="white";
        ctx.textAlign="center";
        ctx.font="16px Arial";
        ctx.fillText(lista[i].nombre,R-60,0);
        ctx.restore();
    }
}

function redibujar(){
    ctx.save();
    ctx.clearRect(0,0,360,360);
    ctx.translate(CX,CY);
    ctx.rotate(anguloActual);
    ctx.translate(-CX,-CY);
    dibujar();
    ctx.restore();
}

redibujar();

/* ===== AGREGAR ===== */
btnAgregar.onclick=function(){

    const nombre=nombreInput.value.trim();
    const numero=numeroInput.value.trim();

    if(!nombre || !numero)
        return alert("Completa los datos");

    if(lista.some(x=>x.numero==numero))
        return alert("N√∫mero duplicado");

    lista.push({nombre,numero});
    guardar();
    redibujar();

    nombreInput.value="";
    numeroInput.value="";
};

/* ===== LIMPIAR ===== */
btnLimpiar.onclick=function(){

    if(!confirm("¬øSeguro que deseas borrar toda la lista?"))
        return;

    lista=[];
    guardar();
    anguloActual=0;
    redibujar();
    resultado.innerText="";
};

/* ===== GIRAR ===== */
function girar(index){

    return new Promise(resolve=>{

        const n=lista.length;
        const angSeg=2*Math.PI/n;
        const centro=index*angSeg+angSeg/2;
        const delta=PUNTERO_ANG-centro;

        const vueltas=6;
        const dur=3000;
        const ini=performance.now();

        function anim(t){

            let p=(t-ini)/dur;
            if(p>1) p=1;

            anguloActual = delta*p + vueltas*2*Math.PI*p;
            redibujar();

            if(p<1) requestAnimationFrame(anim);
            else resolve();
        }

        requestAnimationFrame(anim);
    });
}

/* ===== INICIAR ===== */
btnIniciar.onclick=async function(){

    if(lista.length < 3)
        return alert("Necesitas m√≠nimo 3 participantes");

    let copia=[...lista];

    for(let i=0;i<3;i++){

        const index=Math.floor(Math.random()*copia.length);
        const elegido=copia[index];

        resultado.innerText="üéØ "+elegido.nombre;
        hablar("Participa " + elegido.nombre);

        await girar(index);

        const e=copia[index];

        if(i<2){

            resultado.innerText=e.nombre+" - FUERA ‚ùå";
            hablar(e.nombre + " fuera");

            copia.splice(index,1);
            lista=copia;
            guardar();
            redibujar();

            await new Promise(r=>setTimeout(r,2000));

        }else{

            resultado.innerText="üèÜ "+e.nombre+" GANADOR üéâ";
            hablar("Tenemos ganador. " + e.nombre,0.8,1.2);

            pantallaGanador.style.display="flex";
            pantallaGanador.innerHTML="üèÜ<br>"+e.nombre;

            setTimeout(()=>{
                pantallaGanador.style.display="none";
            },6000);
        }
    }
};
</script>

</body>
</html>
